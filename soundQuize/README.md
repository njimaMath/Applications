# English Listening Quiz (Common Voice)

Command-line helpers to download Mozilla Common Voice data through the Mozilla Data Collective API, convert it into quiz items, and run a small audio quiz that targets confusing English sound pairs.

## Setup
1) Install Python 3.10+ and dependencies:
```
pip install -r requirements.txt
```
2) If you are downloading from a private Hugging Face Hub repo, log in:
```
huggingface-cli login
```

## Download Common Voice
Download a Common Voice dataset split (e.g., the English `validated` split) from Hugging Face Hub:
```
python download_common_voice.py --language en --split validated
```
The script defaults to the `mozilla-foundation/common_voice_16_1` repo. You can list available splits with `--list-splits`. By default the archive is saved to `data/en.tar.gz` and extracted into `data/corpus`.

## Build Quiz Data
Point the converter at a Common Voice metadata TSV (for example, `train.tsv`) and the extracted dataset root:
```
python prepare_quiz_data.py --tsv data/corpus/train.tsv --root data/corpus --output data/quiz_items.json
```
The script scans for sentences containing pairs in the categories `positive_negative`, `L_R`, `V_B`, `S_TH`, and `D_TH`, then outputs quiz-ready JSON pointing to the clip files.

## Run the Terminal Quiz
```
python quiz_cli.py --data data/quiz_items.json --rounds 10
```
Pick a category, listen, and answer with `A` or `B`. Add `--no-audio` if playback is unavailable. If `data/quiz_items.json` is missing, the app falls back to `data/sample_quiz_items.json`.

## Web Quiz (static)
1) Serve the repo root locally (needed so the browser can fetch JSON):  
   `python3 -m http.server 8000`
2) Open `http://localhost:8000/web/`. The page will try to load `../data/quiz_items.json` and fall back to the built-in sample.
3) Use the file picker to load your own `quiz_items.json` generated by `prepare_quiz_data.py`. Audio will play if the `audio` paths in the JSON are reachable from the browser (e.g., `../data/corpus/clip.mp3`).

Note: Do not embed API tokens in the HTML. Keep credentials in `.env` only.

## Project Files
- `download_common_voice.py`: downloads a Common Voice dataset from Hugging Face Hub.
- `prepare_quiz_data.py`: converts Common Voice TSV metadata into quiz items JSON.
- `quiz_cli.py`: terminal quiz runner with optional audio playback.
- `web/index.html`: static web quiz UI that loads `quiz_items.json` or the bundled sample.
- `data/sample_quiz_items.json`: small sample set that shows the JSON format.
- `.gitignore`: keeps credentials (`.env`) and large dataset artifacts out of version control.
- `instruction.tex`: reference instructions for the application.
